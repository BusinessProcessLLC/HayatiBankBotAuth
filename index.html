<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="app.title">🏦 FH of Hayati — Sign In</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="https://hayati-coin.github.io/website/OfficialLogo.jpg">
  <link rel="apple-touch-icon" href="https://hayati-coin.github.io/website/OfficialLogo.jpg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=Noto+Naskh+Arabic:wght@700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="css/main.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="i18n-pending">
  <header class="topbar">
    <div class="brand-wrap">
      <div class="logo-seal" aria-label="Hayati Bank seal">
        <svg class="logo-ring" viewBox="0 0 120 120" aria-hidden="true">
          <defs>
            <path id="sealCirclePath" d="M60,60 m-43,0 a43,43 0 1,1 86,0 a43,43 0 1,1 -86,0"></path>
          </defs>
          <text class="logo-ring-text">
            <textPath href="#sealCirclePath" startOffset="0%">
              بنك حياتي • بنك حياتي • بنك حياتي •
            </textPath>
          </text>
        </svg>
        <img class="brand-logo" src="https://hayati-coin.github.io/website/OfficialLogo.jpg" alt="Hayati Bank">
      </div>
      <a class="home-button" href="https://hayatibank.ru" title="Back Home">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 11.5L12 4l9 7.5"></path>
          <path d="M5 10.5V20h14v-9.5"></path>
          <path d="M9 20v-6h6v6"></path>
        </svg>
        <span data-i18n="common.backHome">Back Home</span>
      </a>
    </div>

    <div class="brand-frame">
      <div class="brand brand-ar" aria-label="Hayati Bank in Arabic">بنك حياتي</div>
    </div>

    <div class="header-meta">
      <div class="lang-switch" id="langSwitch" role="group" aria-label="Language switch">
        <button type="button" class="lang-btn" data-lang="en">EN</button>
        <button type="button" class="lang-btn" data-lang="ru">RU</button>
      </div>
      <div class="pref-switchers" role="group" aria-label="Display preferences">
        <label class="pref-switch">
          <span>CCY</span>
          <select id="topbarCurrencySwitch">
            <option value="USD">USD</option>
            <option value="AED">AED</option>
            <option value="RUB">RUB</option>
          </select>
        </label>
        <label class="pref-switch">
          <span>SYS</span>
          <select id="topbarMetricSwitch">
            <option value="imperial">Imperial</option>
            <option value="metric">Metric</option>
          </select>
        </label>
      </div>
      <div class="project-meta">Hayati ID | Cabinet</div>
      <span class="data-badge" id="topbarStatusBadge">Secure Access</span>
    </div>
  </header>

  <div class="container">
    
    <!-- ======================== -->
    <!-- LOADING SCREEN -->
    <!-- ======================== -->
    <div id="loadingScreen" class="screen">
      <div class="loading-center">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- ======================== -->
    <!-- AUTH SCREEN -->
    <!-- ======================== -->
    <div id="authScreen" class="screen hidden">
      <div class="logo">
        <h1 data-i18n="app.brand">FH of Hayati</h1>
        <p class="subtitle" data-i18n="app.subtitle">Capital Management</p>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="form-card">
        <h2 data-i18n="auth.login.title">Sign In</h2>
        
        <div class="input-group">
          <label for="loginEmail" data-i18n="auth.login.email">Email</label>
          <input type="email" id="loginEmail" data-i18n="auth.login.emailPlaceholder" placeholder="your@email.com" autocomplete="email">
        </div>

        <div class="input-group">
          <label for="loginPassword" data-i18n="auth.login.password">Password</label>
          <div class="password-input-wrapper">
            <input type="password" id="loginPassword" data-i18n="auth.login.passwordPlaceholder" placeholder="••••••••" autocomplete="current-password">
            <button type="button" class="btn-toggle-password" onclick="togglePassword('loginPassword')">
              <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-off-icon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <button id="loginBtn" class="btn-3d btn-3d-compact btn-auth-prime">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
          <span data-i18n="auth.login.submit">Sign In</span>
        </button>
        
        <div class="links">
          <button type="button" id="forgotPasswordLink" class="auth-link-btn" data-i18n="auth.login.forgotPassword">Forgot password?</button>
          <button type="button" id="showRegisterLink" class="auth-link-btn" data-i18n="auth.login.register">Register</button>
        </div>

        <div id="loginError" class="error hidden"></div>
      </div>

      <!-- Register Form -->
      <div id="registerForm" class="form-card hidden">
        <h2 data-i18n="auth.register.title">Register</h2>
        
        <div class="input-group">
          <label for="registerEmail" data-i18n="auth.register.email">Email</label>
          <input type="email" id="registerEmail" data-i18n="auth.register.emailPlaceholder" placeholder="your@email.com" autocomplete="email">
        </div>

        <div class="input-group">
          <label for="registerPassword" data-i18n="auth.register.password">Password</label>
          <div class="password-input-wrapper">
            <input type="password" id="registerPassword" data-i18n="auth.register.passwordPlaceholder" placeholder="Minimum 6 characters" autocomplete="new-password">
            <button type="button" class="btn-toggle-password" onclick="togglePassword('registerPassword')">
              <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-off-icon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="input-group">
          <label for="registerPasswordConfirm" data-i18n="auth.register.passwordConfirm">Confirm Password</label>
          <div class="password-input-wrapper">
            <input type="password" id="registerPasswordConfirm" data-i18n="auth.register.passwordConfirmPlaceholder" placeholder="••••••••" autocomplete="new-password">
            <button type="button" class="btn-toggle-password" onclick="togglePassword('registerPasswordConfirm')">
              <svg class="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-off-icon hidden" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
        </div>

        <button id="registerBtn" class="btn-3d btn-3d-compact btn-auth-prime">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
          </svg>
          <span data-i18n="auth.register.submit">Create Account</span>
        </button>
        
        <div class="links">
          <button type="button" id="showLoginLink" class="auth-link-btn auth-link-btn-wide" data-i18n="auth.register.haveAccount">Already have an account? Sign In</button>
        </div>

        <div id="registerError" class="error hidden"></div>
      </div>

      <!-- Reset Password Form -->
      <div id="resetForm" class="form-card hidden">
        <h2 data-i18n="auth.reset.title">Reset Password</h2>
        
        <p class="info-text" data-i18n="auth.reset.info">Enter your email and we will send you a password reset link</p>
        
        <div class="input-group">
          <label for="resetEmail" data-i18n="auth.reset.email">Email</label>
          <input type="email" id="resetEmail" data-i18n="auth.reset.emailPlaceholder" placeholder="your@email.com" autocomplete="email">
        </div>

        <button id="resetBtn" class="btn-3d btn-3d-compact btn-auth-prime">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
          </svg>
          <span data-i18n="auth.reset.submit">Send Reset Link</span>
        </button>
        
        <div class="links">
          <button type="button" id="backToLoginLink" class="auth-link-btn auth-link-btn-wide" data-i18n="auth.reset.backToLogin">Back to Sign In</button>
        </div>

        <div id="resetError" class="error hidden"></div>
        <div id="resetSuccess" class="success hidden"></div>
      </div>
    </div>

    <!-- ======================== -->
    <!-- CABINET SCREEN -->
    <!-- ======================== -->
    <div id="cabinetScreen" class="screen hidden">
      <div class="cabinet-card">
        <div class="cabinet-header">
          <h2 data-i18n="cabinet.title">💼 Personal Cabinet</h2>
          <p class="user-email">loading...</p>
          <!-- HYC balance will be rendered here by hycUI.js -->
        </div>

        <div class="cabinet-content">
          <p data-i18n="app.cabinetWelcome">🎉 Welcome!</p>
          <p data-i18n="app.cabinetDescription">Here will be your cabinet with balance, payments and capital management.</p>
        </div>

        <div class="cabinet-actions">
          <button onclick="showProfileMenu()" class="btn btn-ghost">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
            <span data-i18n="cabinet.settings">⚙️ Settings</span>
          </button>

          <button onclick="logout()" class="btn btn-ghost">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
            </svg>
            <span data-i18n="auth.logout.button">🚪 Logout</span>
          </button>
        </div>
      </div>
    </div>

    <!-- ======================== -->
    <!-- PROFILE MENU MODAL -->
    <!-- ======================== -->
    <div id="profileMenu" class="modal hidden">
      <div class="modal-overlay" onclick="closeProfileMenu()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="settings.title">⚙️ Profile Settings</h3>
          <button onclick="closeProfileMenu()" class="btn-close">×</button>
        </div>
        <div class="modal-body">
          
          <!-- Profile Section -->
          <div class="setting-item">
            <h4 data-i18n="settings.profile.title">👤 Profile</h4>
            <p class="setting-description" data-i18n="settings.profile.description">Manage profile and personal data</p>
            <button class="btn btn-secondary btn-small" onclick="alert(window.i18n.t('settings.inDevelopment'))">
              <span data-i18n="settings.profile.edit">Edit Profile</span>
            </button>
          </div>
          
          <!-- Language & Region Section -->
          <div class="setting-item">
            <h4 data-i18n="settings.language.title">🌍 Language & Region</h4>
            <p class="setting-description" data-i18n="settings.language.description">Language, currency and format settings</p>
            
            <div class="setting-group">
              <label for="languageSelect" data-i18n="settings.language.language">Language</label>
              <select id="languageSelect" class="setting-select" onchange="handleLanguageChange(this.value)">
                <option value="ru">RU Русский</option>
                <option value="en">EN English</option>
              </select>
            </div>
            
            <div class="setting-group">
              <label for="currencySelect" data-i18n="settings.language.currency">Currency</label>
              <select id="currencySelect" class="setting-select">
                <option value="rub">RUB Ruble</option>
                <option value="usd">USD Dollar</option>
                <option value="aed">AED Dirham</option>
              </select>
            </div>
            
            <div class="setting-group">
              <label for="timezoneSelect" data-i18n="settings.language.timezone">Timezone</label>
              <select id="timezoneSelect" class="setting-select">
                <option value="europe/moscow">Europe/Moscow (MSK)</option>
                <option value="asia/dubai">Asia/Dubai (GST)</option>
                <option value="utc">UTC</option>
              </select>
            </div>
          </div>
          
          <!-- Notifications Section -->
          <div class="setting-item">
            <h4 data-i18n="settings.notifications.title">🔔 Notifications</h4>
            <p class="setting-description" data-i18n="settings.notifications.description">Configure notifications and alerts</p>
            <button class="btn btn-secondary btn-small" onclick="alert(window.i18n.t('settings.inDevelopment'))">
              <span data-i18n="settings.notifications.configure">Configure</span>
            </button>
          </div>
          
          <!-- Danger Zone -->
          <div class="setting-item danger-zone">
            <h4 data-i18n="settings.dangerZone.title">⚠️ Danger Zone</h4>
            <p class="setting-description warning-text" data-i18n="settings.dangerZone.warning">Deleting your account will permanently remove all your data from FH of Hayati system</p>
            <button onclick="deleteAccount()" class="btn btn-danger btn-small">
              <span data-i18n="settings.dangerZone.deleteButton">🗑️ Delete from FH of Hayati</span>
            </button>
          </div>
          
        </div>
      </div>
    </div>

  </div>

  <!-- Profile Menu & Password Toggle Functions -->
  <script type="module" src="js/settings/profileSettings.js"></script>
  
  <!-- Additional CSS for settings -->
  <style>
    .setting-group {
      margin-top: 16px;
    }

    .setting-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
    }

    .setting-select {
      width: 100%;
      padding: 10px 14px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
      transition: all 0.2s;
      cursor: pointer;
    }

    .setting-select:hover:not(:disabled) {
      border-color: var(--neon-blue);
    }

    .setting-select:focus {
      outline: none;
      border-color: var(--neon-blue);
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
    }

    .setting-select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .setting-note {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 8px;
      font-style: italic;
    }
  </style>

<!-- ======================== -->
  <!-- ANDROID FREEZE DETECTOR (TEMPORARY) -->
  <!-- ======================== -->
  <script>
    // Freeze detector - logs when UI freezes for more than 2 seconds
    let lastLog = Date.now();
    
    const freezeDetector = setInterval(() => {
      const now = Date.now();
      const diff = now - lastLog;
      
      if (diff > 2000) {
        console.error('[freeze] detected:', diff + 'ms gap');
        console.log('[freeze] debug info:');
        console.log('  Current language:', window.i18n?.getCurrentLanguage());
        console.log('  Initialized:', window.i18n?.initialized);
        console.log('  Translations loaded:', Object.keys(window.i18n?.translations || {}).length);
        console.log('  Current screen:', {
          loading: !document.getElementById('loadingScreen')?.classList.contains('hidden'),
          auth: !document.getElementById('authScreen')?.classList.contains('hidden'),
          cabinet: !document.getElementById('cabinetScreen')?.classList.contains('hidden')
        });
      }
      
      lastLog = now;
    }, 500);
    
    const clearI18nPending = () => {
      document.body.classList.remove('i18n-pending');
    };

    // Log when i18n is ready
    window.addEventListener('i18nReady', (e) => {
      clearI18nPending();
      console.log('[i18n] ready event fired:', e.detail);
      console.log('  Time:', new Date().toLocaleTimeString());
    });

    // Safety fallback: don't keep UI hidden if i18n event was missed
    setTimeout(clearI18nPending, 3000);
    
    // Clear detector after 5 minutes (to prevent memory issues)
    setTimeout(() => {
      clearInterval(freezeDetector);
      console.log('[freeze] detector stopped (5min timeout)');
    }, 5 * 60 * 1000);
  </script>

  <!-- Firebase & App -->
  <script type="module" src="app.js"></script>

  <!-- Bitrix24 CRM Chat Widget -->
  <script>
    (function(w,d,u){
      var s=d.createElement('script');s.async=true;s.src=u+'?'+(Date.now()/60000|0);
      var h=d.getElementsByTagName('script')[0];h.parentNode.insertBefore(s,h);
    })(window,document,'https://cdn-ru.bitrix24.ru/b18367972/crm/site_button/loader_2_9i9oo2.js');
  </script>

</body>
</html>

